<?xml version="1.0" encoding="UTF-8"?>
<project name="GenJ" default="dist" basedir=".">

  <taskdef name="izpack" classpath="./contrib/izpack/lib/standalone-compiler.jar" classname="com.izforge.izpack.ant.IzPackTask"/>

  <!--
   Initialization
   -->
  <target name="init">
    <echo level="info">Creating output directories</echo>
    <mkdir dir="./build"/>
    <mkdir dir="./build/dist"/>
  </target>
  
  <!--
   Initialization
   -->
  <target name="clean">
    <echo level="info">Cleaning output directories</echo>
    <delete includeemptydirs="true" failonerror="false">
      <fileset dir="./build" excludes="eclipse/*"/>
    </delete>
    <ant dir="./geo" inheritall="false" target="clean"/>
    <ant dir="./app" inheritall="false" target="clean"/>
  </target>
  
  <!--
   Nested Project - App
   -->  
  <target name="dist.app" depends="init">
  	<ant dir="./app" inheritall="false" target="dist"/>
  	<move todir="./build/dist">
  		<fileset dir="./app/build/dist/"/>
  	</move>
  	<echo level="info">Initializing version information</echo>
  	<property file="./app/build/version.properties"/>
  	<echo level="info">Version = ${version}</echo>
  	<fail unless="version" message="no version information available"/>
  </target>
  
  <!--
   Nested Project - Geo
   -->  
  <target name="dist.geo" depends="dist.app">
    <ant dir="./geo" inheritall="false" target="dist">
      <property name="dir.app" value="../app"/>
    </ant>
    <move todir="./build/dist">
      <fileset dir="./geo/build/dist/"/>
    </move>
  </target>
  
	<!-- 
	izpack packaging
	-->
	<target name="dist.installer" depends="dist.app, dist.geo">
		
    <copy tofile="./build/installer.xml" file="./src/installer/installer.xml">
      <filterset><filter token="version" value="${version}"/></filterset>
    </copy>
 	
    <izpack input="./build/installer.xml" output="./build/dist/genj_install-${version}.jar" installerType="standard" basedir="." izpackdir="./contrib/izpack"/>
		
	</target>
	
  <!--
   Distribution
   -->
  <target name="dist" depends="dist.installer">

  </target>

</project>
